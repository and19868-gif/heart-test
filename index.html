<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡€ç®¡å¹´é½¡è‡ªæ¸¬ç³»çµ±</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; padding: 15px; background-color: #f4f7f9; color: #333; }
        .container { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2c3e50; margin-bottom: 20px; }
        .q-box { padding: 15px; border-bottom: 1px solid #edf2f7; display: flex; align-items: flex-start; cursor: pointer; transition: 0.2s; }
        .q-box:active { background-color: #f0f4f8; }
        .q-box input { width: 22px; height: 22px; margin-right: 12px; margin-top: 2px; flex-shrink: 0; }
        .q-box label { font-size: 16px; line-height: 1.5; cursor: pointer; }
        .btn { background: #4A90E2; color: white; border: none; padding: 16px; width: 100%; border-radius: 12px; font-size: 18px; font-weight: bold; margin-top: 25px; cursor: pointer; }
        #result { display: none; margin-top: 10px; }
        .result-card { padding: 20px; border-radius: 15px; text-align: left; line-height: 1.6; border: 2px solid; }
    </style>
</head>
<body>
    <div class="container">
        <h2>è¡€ç®¡å¥åº·è‡ªæ¸¬é‡è¡¨</h2>
        <div id="quiz">æ­£åœ¨å®‰å…¨åŒæ­¥è¨ºæ‰€è³‡æ–™...</div>
        <button id="submitBtn" class="btn" style="display:none;" onclick="calculate()">æäº¤ä¸¦æŸ¥çœ‹åˆ†æçµæœ</button>
        <div id="result"></div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwPYLcEmyspm5IeGi1Qg4lZgsJqNStwrLYfVVA_IfQtk74k-ii-enUBu93Syl9T5PQ/exec";
        let userName = "LINEç”¨æˆ¶", userId = "æœªçŸ¥ID", questionList = [];

        liff.init({ liffId: "2009061399-LVES2gnp" }).then(() => {
            if (liff.isLoggedIn()) {
                liff.getProfile().then(p => {
                    userName = p.displayName; userId = p.userId;
                    fetchQuestions();
                });
            } else { liff.login(); }
        }).catch(err => fetchQuestions());

        function fetchQuestions() {
            fetch(API_URL).then(res => res.json()).then(data => {
                questionList = data;
                const container = document.getElementById('quiz');
                container.innerHTML = "";
                data.forEach((q, i) => {
                    container.innerHTML += `<div class="q-box" onclick="toggleCheck(${i})"><input type="checkbox" class="q" id="q${i}" onclick="event.stopPropagation()"><label>${q}</label></div>`;
                });
                document.getElementById('submitBtn').style.display = "block";
            }).catch(err => {
                document.getElementById('quiz').innerHTML = "è³‡æ–™é€£ç·šæš«æ™‚ä¸ç©©å®šï¼Œè«‹é‡æ–°é–‹å•Ÿã€‚";
            });
        }

        function toggleCheck(i) {
            const cb = document.getElementById('q'+i);
            if(cb) cb.checked = !cb.checked;
        }

        function calculate() {
            const checks = document.querySelectorAll('.q');
            let score = 0, details = [];
            checks.forEach(c => { score += c.checked ? 1 : 0; details.push(c.checked); });

            let level, color, age, content, suggest;
            if (score <= 3) {
                level = "ç¬¬ä¸€ç´šï¼šç¶ è‰²è­¦æˆ’"; color = "#28a745"; age = "ç›¸ç¬¦";
                content = "ç›®å‰æ‚¨çš„è¡€ç®¡ç‹€æ³å°šå±¬å¥åº·ï¼Œä½†ç¾ä»£äººç”Ÿæ´»ç¯€å¥å¿«ï¼Œéš±å½¢å£“åŠ›ä¸å¯æ‰ä»¥è¼•å¿ƒã€‚";
                suggest = "ç¹¼çºŒä¿æŒè‰¯å¥½çš„é£²é£Ÿèˆ‡é‹å‹•ç¿’æ…£ï¼Œå®ˆè­·å¥åº·å­˜æ‘ºã€‚";
            } else if (score <= 7) {
                level = "ç¬¬äºŒç´šï¼šé»ƒè‰²è­¦æˆ’"; color = "#f39c12"; age = "é ä¼°å¤§æ–¼ç”Ÿç†å¹´é½¡ 10 æ­²";
                content = "æ‚¨çš„è¡€ç®¡å·²ç¶“é–‹å§‹ç™¼å‡ºã€Œç–²å‹è­¦è¨Šã€ï¼é•·æœŸå¤–é£Ÿèˆ‡ä¹…åæ­£åœ¨åŠ é€Ÿè¡€ç®¡ç¡¬åŒ–ã€‚";
                suggest = "è¡€ç®¡å½ˆæ€§æ­£åœ¨æµå¤±ä¸­ã€‚å»ºè­°å„˜æ—©ä¾†é™¢é€²è¡Œå°ˆæ¥­æª¢æ¸¬ã€‚";
            } else {
                level = "ç¬¬ä¸‰ç´šï¼šç´…è‰²è­¦å ±"; color = "#dc3545"; age = "é ä¼°å¤§æ–¼ç”Ÿç†å¹´é½¡ 20 æ­²";
                content = "å±éšªï¼æ‚¨çš„è¡€ç®¡å¥åº·å¯èƒ½å·²è™•æ–¼è‡¨ç•Œé»ï¼èƒ¸æ‚¶ã€æ–·ç‰‡ç­‰ä¿¡è™Ÿé¡¯è‘—å¢åŠ æ„å¤–é¢¨éšªã€‚";
                suggest = "è«‹ç«‹å³é ç´„æ›è™Ÿé€²è¡Œæ·±åº¦è©•ä¼°ï¼Œä¸è¦å†ç­‰å¾…ã€‚";
            }

            document.getElementById('quiz').style.display = "none";
            document.getElementById('submitBtn').style.display = "none";
            const resDiv = document.getElementById('result');
            resDiv.style.display = "block";
            resDiv.innerHTML = `
                <div class="result-card" style="border-color:${color}; background-color:${color}11;">
                    <h2 style="color:${color}; text-align:center;">${level}</h2>
                    <p><strong>ã€è¡€ç®¡å¹´é½¡ï¼š${age}ã€‘</strong></p>
                    <p>${content}</p>
                    <hr style="border:0; border-top:1px solid ${color}44;">
                    <p>ğŸ’¡ å»ºè­°ï¼š${suggest}</p>
                    <button onclick="liff.closeWindow()" style="background:${color}; color:white; padding:15px; width:100%; border:none; border-radius:10px; margin-top:20px; font-weight:bold; cursor:pointer;">ç¢ºèªä¸¦é—œé–‰è¦–çª—</button>
                </div>
            `;

            // åŒæ­¥å­˜æª”
            fetch(API_URL, {
                method: "POST",
                mode: 'no-cors', // è§£æ±ºè·¨ç¶²åŸŸå­˜å–å•é¡Œ
                body: JSON.stringify({userId, userName, score, level, details})
            });
        }
    </script>
</body>
</html>