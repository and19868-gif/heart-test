<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡€ç®¡å¹´é½¡è‡ªæ¸¬ç³»çµ±</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; padding: 15px; background-color: #f4f7f9; color: #333; }
        .container { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* å°é¢åœ–æ¨£å¼ */
        .cover-img { width: 100%; border-radius: 15px; margin-bottom: 20px; display: block; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        h2 { text-align: center; color: #2c3e50; margin-bottom: 20px; }
        
        /* é¡Œç›®å€å¡Šæ¨£å¼ */
        .q-box { 
            padding: 15px; border-bottom: 1px solid #edf2f7; 
            display: flex; flex-direction: column; cursor: pointer; 
            margin-bottom: 15px; background: #fff; border-radius: 12px;
            transition: 0.2s;
        }
        .q-box:active { background-color: #f0f4f8; }
        .q-img { width: 100%; max-height: 250px; object-fit: cover; border-radius: 10px; margin-bottom: 12px; }
        .q-text-row { display: flex; align-items: flex-start; width: 100%; }
        .q-text-row input { width: 22px; height: 22px; margin-right: 12px; margin-top: 2px; flex-shrink: 0; }
        .q-text-row label { font-size: 16px; line-height: 1.5; cursor: pointer; }
        
        .btn { background: #4A90E2; color: white; border: none; padding: 16px; width: 100%; border-radius: 12px; font-size: 18px; font-weight: bold; margin-top: 25px; cursor: pointer; box-shadow: 0 4px 6px rgba(74,144,226,0.3); }
        #result { display: none; margin-top: 10px; }
        .result-card { padding: 20px; border-radius: 15px; text-align: left; line-height: 1.6; border: 2px solid; }
    </style>
</head>
<body>
    <div class="container">
        <img src="https://and19868-gif.github.io/heart-test/cover.jpg" id="mainCover" class="cover-img" alt="è¡€ç®¡å¹´é½¡è‡ªæ¸¬å°é¢">
        
        <h2 id="mainTitle">è¡€ç®¡å¥åº·è‡ªæ¸¬é‡è¡¨</h2>
        
        <div id="quiz">æ­£åœ¨å®‰å…¨åŒæ­¥è¨ºæ‰€è³‡æ–™...</div>
        
        <button id="submitBtn" class="btn" style="display:none;" onclick="calculate()">æäº¤ä¸¦æŸ¥çœ‹åˆ†æçµæœ</button>
        
        <div id="result"></div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwPYLcEmyspm5IeGi1Qg4lZgsJqNStwrLYfVVA_IfQtk74k-ii-enUBu93Syl9T5PQ/exec";
        let userName = "LINEç”¨æˆ¶", userId = "æœªçŸ¥ID", questionList = [];

        liff.init({ liffId: "2009061399-LVES2gnp" }).then(() => {
            if (liff.isLoggedIn()) {
                liff.getProfile().then(p => {
                    userName = p.displayName; userId = p.userId;
                    fetchQuestions();
                });
            } else { liff.login(); }
        }).catch(err => fetchQuestions());

        function fetchQuestions() {
            fetch(API_URL).then(res => res.json()).then(data => {
                questionList = data;
                const container = document.getElementById('quiz');
                container.innerHTML = "";
                
                data.forEach((q, i) => {
                    // å¦‚æœè©¦ç®—è¡¨ B æ¬„æœ‰ç¶²å€ï¼Œå°±é¡¯ç¤ºåœ–ç‰‡
                    const imgTag = q.img ? `<img src="${q.img}" class="q-img">` : "";
                    container.innerHTML += `
                        <div class="q-box" onclick="toggleCheck(${i})">
                            ${imgTag}
                            <div class="q-text-row">
                                <input type="checkbox" class="q" id="q${i}" onclick="event.stopPropagation()">
                                <label>${q.text}</label>
                            </div>
                        </div>`;
                });
                document.getElementById('submitBtn').style.display = "block";
            }).catch(err => {
                document.getElementById('quiz').innerHTML = "è³‡æ–™é€£ç·šæš«æ™‚ä¸ç©©å®šï¼Œè«‹é‡æ–°é–‹å•Ÿã€‚";
            });
        }

        function toggleCheck(i) {
            const cb = document.getElementById('q'+i);
            if(cb) cb.checked = !cb.checked;
        }

        function calculate() {
            const checks = document.querySelectorAll('.q');
            let score = 0, details = [];
            checks.forEach(c => { score += c.checked ? 1 : 0; details.push(c.checked); });

            let level, color, age, content, suggest;
            
            if (score <= 3) {
                level = "ç¬¬ä¸€ç´šï¼šç¶ è‰²è­¦æˆ’"; color = "#28a745"; age = "è¡€ç®¡å¹´é½¡ï¼šèˆ‡ç”Ÿç†å¹´é½¡ç›¸ç¬¦";
                content = "ç›®å‰æ‚¨çš„è¡€ç®¡ç‹€æ³å°šå±¬å¥åº·ï¼Œä½†ç¾ä»£äººç”Ÿæ´»ç¯€å¥å¿«ï¼Œéš±å½¢å£“åŠ›ä¸å¯æ‰ä»¥è¼•å¿ƒã€‚";
                suggest = "ç¹¼çºŒä¿æŒè‰¯å¥½çš„é£²é£Ÿèˆ‡é‹å‹•ç¿’æ…£ï¼Œä¸¦ç¶­æŒæ¯å¹´ä¸€æ¬¡çš„å®šæœŸè¿½è¹¤æª¢æŸ¥ï¼Œå®ˆè­·å¥åº·å­˜æ‘ºã€‚";
            } else if (score <= 7) {
                level = "ç¬¬äºŒç´šï¼šé»ƒè‰²è­¦æˆ’"; color = "#f39c12"; age = "è¡€ç®¡å¹´é½¡ï¼šé ä¼°å¤§æ–¼ç”Ÿç†å¹´é½¡ 10 æ­²";
                content = "æ‚¨çš„è¡€ç®¡å·²ç¶“é–‹å§‹ç™¼å‡ºã€Œç–²å‹è­¦è¨Šã€ï¼é•·æœŸå¤–é£Ÿèˆ‡ä¹…åæ­£åœ¨åŠ é€Ÿè¡€ç®¡ç¡¬åŒ–èˆ‡ä»£è¬ç·©æ…¢ã€‚";
                suggest = "è¡€ç®¡å½ˆæ€§æ­£åœ¨æµå¤±ä¸­ã€‚å»ºè­°å„˜æ—©ä¾†é™¢é€²è¡Œå°ˆæ¥­æª¢æ¸¬ï¼ˆå¦‚è¡€è„‚ã€è¡€ç³–åŠç™¼ç‚æŒ‡æ¨™ï¼‰ï¼Œç”±é†«å¸«ç‚ºæ‚¨è¦åŠƒç”Ÿæ´»è½‰å‹è¨ˆç•«ã€‚";
            } else {
                level = "ç¬¬ä¸‰ç´šï¼šç´…è‰²è­¦å ±"; color = "#dc3545"; age = "è¡€ç®¡å¹´é½¡ï¼šé ä¼°å¤§æ–¼ç”Ÿç†å¹´é½¡ 20 æ­²";
                content = "å±éšªï¼æ‚¨çš„è¡€ç®¡å¥åº·å¯èƒ½å·²è™•æ–¼è‡¨ç•Œé»ï¼èƒ¸æ‚¶ã€æ–·ç‰‡èˆ‡è¡€å£“ç´…å­—æ˜¯èº«é«”çš„æ±‚æ•‘ä¿¡è™Ÿï¼Œç™¼ç”Ÿå¿ƒè¡€ç®¡æ„å¤–çš„é¢¨éšªé¡¯è‘—å¢åŠ ã€‚";
                suggest = "è«‹ç«‹å³é ç´„æ›è™Ÿé€²è¡Œæ·±åº¦å¿ƒè¡€ç®¡è©•ä¼°ã€‚æ‚¨å¯èƒ½éœ€è¦å°ˆæ¥­å½±åƒæª¢æŸ¥ï¼ˆå¦‚é ¸å‹•è„ˆè¶…éŸ³æ³¢ï¼‰æˆ–è—¥ç‰©ä»‹å…¥ã€‚ç‚ºäº†å®¶äººèˆ‡è‡ªå·±ï¼Œè«‹ä¸è¦å†ç­‰å¾…ã€‚";
            }

            // éš±è—å°é¢èˆ‡é¡Œç›®
            document.getElementById('mainCover').style.display = "none";
            document.getElementById('mainTitle').style.display = "none";
            document.getElementById('quiz').style.display = "none";
            document.getElementById('submitBtn').style.display = "none";
            
            const resDiv = document.getElementById('result');
            resDiv.style.display = "block";
            resDiv.innerHTML = `
                <div class="result-card" style="border-color:${color}; background-color:${color}11;">
                    <h2 style="color:${color}; text-align:center;">${level}</h2>
                    <p style="font-size: 17px; font-weight: bold; margin-bottom: 10px;">ã€${age}ã€‘</p>
                    <p style="font-size: 15px; margin-bottom: 15px;">${content}</p>
                    <hr style="border:0; border-top:1px solid ${color}44; margin-bottom: 15px;">
                    <p style="font-size: 15px;"><strong>ğŸ’¡ å»ºè­°ï¼š</strong>${suggest}</p>
                    <button onclick="liff.closeWindow()" style="background:${color}; color:white; padding:15px; width:100%; border:none; border-radius:10px; margin-top:20px; font-weight:bold; cursor:pointer; font-size: 16px;">ç¢ºèªä¸¦é—œé–‰è¦–çª—</button>
                </div>
            `;

            fetch(API_URL, {
                method: "POST",
                mode: 'no-cors',
                body: JSON.stringify({userId, userName, score, level, details})
            });
        }
    </script>
</body>
</html>